[Intrabarordergeneration=true]

{
		Type - Signal
		Name - GD exit suite
		Desc - This Signal has selectable multiple exits
		Adapted from Neil Wrightson(BigMikeTrading forum) and M Tompkins (GitHub)
}

{Required inputs for exit}

Input: 	
		UseStrategyName(False),			// Edit to true and then rename below to strat name
		StrategyName("Change to map strat"),	// Change name to match strat in use
		//PositionBasis( false ) ,			// true - shares, false - contracts ***check this
		
		PctTrailing("-- Pct Trailing --"), 	// Label
		Enable_Pct_Trail(1), 			// 0 - Disabled | 1 - Enabled
		Init_percent_trail$1( 100 ), 		// Figure to begin percent profit capture trail
		TrailingPct1( 73 ), 				// 1st level percentage drop to close profitable position and retain profit, e.g. 20 closes after max position profit drops by 20%                             
		//pct_Trail_min (45),			// Figure of maxposition profit when to kick off trailing percentage stop, i.e. $62.50
		Init_percent_trail$2( 225.00),		// 2nd level to change pct trail to lower figure
		TrailingPct2 ( 20 ),				// Attempt to retain more runup profit, e.g. switch from 70% trail to tighter 20% trail
			 
		
		Dollar_Trailing("-- Dollar trailing --"), // Label
		Enable_Dollar_Trail(1),			// 0 - Disabled | 1 - Enabled
		Init_dollar_trail1 (187.50),		// Dollar amount to begin trail stop
		Dollar_trail_amt1 (150.00),			// 1st dollar amt to trail behind profit	
		Init_dollar_trail2 (275.00),		// Dollar amount to begin trail stop
		Dollar_trail_amt2 (162.50);			// 2nd lvel dollar amt to trail behind profit	
		


Vars: 		Double TickSize (0),
		MP(marketposition);

		
		TickSize = minmove/pricescale;		
	
		
		// Check for integer input
		If TrailingPct1 <> IntPortion(TrailingPct1) Then begin
				Alert;
				Abort;
				end;


		{*************************************************}
		{ P E R C E N T T R A I L I N G }
		{*************************************************}

			
		Condition1 = Enable_Pct_Trail = 1 and MP <> 0 and (Init_percent_trail$1 > 0 and TrailingPct1 > 0 or 

		Init_percent_trail$2 > 0 and TrailingPct2 > 0);
		
					
		
		// percent trailing treatment levels, above and below 140	
		if condition1 then 
		//begin
		
					
		condition2 = maxpositionprofit >= Init_percent_trail$1 and maxpositionprofit < Init_percent_trail$2 ;	
		condition3 = maxpositionprofit >= Init_percent_trail$2 ;

			//setstopcontract;
			if condition2 then
			SetPercentTrailing	( Init_percent_trail$1, TrailingPct1 ) ; //e.g. once max pos profit hits 112.50 but lower than MPP 150 then trail stop at 50%
			
			if condition3 then
			SetPercentTrailing	( Init_percent_trail$2, TrailingPct2 ) ; //e.g if max pos profit is over MPP 150 then trail stop at 20% drop in profit
			

			//end;
		
		
		{*************************************************}
		{ DOLLAR TRAILING }
		{*************************************************}

			
		condition5 = MP <> 0 and Init_dollar_trail1 > 0 and Enable_Dollar_Trail = 1 ;
		
		if condition5 then
		//begin
				
						
			condition6 = maxpositionprofit >= Init_dollar_trail1 ;
			condition7 = maxpositionprofit >=  Init_dollar_trail2 ;
			
			if condition6 then
				SetDollarTrailing( Dollar_trail_amt1 ) ; // if max pos profit > init dollar trail 1, e.g. if run up hits 75, then trail stop at $50
				
				
			if condition7 then
				SetDollarTrailing( Dollar_trail_amt2 ) ; // if max pos profit > init dollar trail 2, e.g. if run up hits 187.50, then trail stop at $125
				

//end;
